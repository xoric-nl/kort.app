<!DOCTYPE html>
<html lang="en" class="uk-background-secondary">
<head>
    <meta charset="UTF-8">
    <title>Home &middot; kort.app</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="img/favicon.png"/>

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.5.4/dist/css/uikit.min.css" />

    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.5.4/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.5.4/dist/js/uikit-icons.min.js"></script>

    <!-- jQuery-->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <!-- ClipboardJs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap');

        #newUrl:active,
        #newUrl:focus {
            background: transparent;
        }

        #newUrl {
            font-family: 'Roboto Mono', monospace;
        }

        #smallText {
            font-size: 40px;
        }
    </style>
</head>
<body>
    <div class="uk-container uk-text-muted">
        <div class="uk-text-center uk-text-success uk-margin-large-top">
<!--            <h1 class="uk-text-success">Kort.App</h1>-->
            <img src="img/logo.png" width="60%" />
            <p class="uk-text-large" id="smallText">Lekker kort!</p>
        </div>
        <div class="uk-form-stacked uk-margin-large-top" id="inputForm">
            <div class="uk-margin uk-text-danger uk-hidden" id="errorMessage">
                Helaas, de gebruikte URL is niet langer beschikbaar.
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" style="color: #ddd;">URL Om te verkleinen</label>
                <input type="text" class="uk-input" placeholder="https://example.com" id="urlToShorten">
            </div>
            <div class="uk-margin uk-text-center">
                <a type="submit" class="uk-button uk-button-primary" onclick="submit();">Verzenden</a>
            </div>
        </div>
        <div id="successNotification" class="uk-hidden uk-text-center uk-margin-large-top">
            <p style="color: #ccc; font-size: 20px;" class="uk-margin-medium-bottom">
                Je nieuwe url is
            </p>
            <input type="text" style="font-size: 30px;" id="newUrl" class="uk-input uk-form-blank uk-text-center" readonly />
            <button class="uk-button uk-button-small uk-button-primary uk-margin-medium-top" onclick="copyNewUrl()">Kopieer</button>
            <br/>
            <a class="uk-button uk-button-small uk-button-link uk-margin-medium-top" href="/">Terug</a>
        </div>
    </div>

    <script>
        function copyNewUrl() {
            /* Get the text field */
            var copyText = document.getElementById("newUrl");

            /* Select the text field */
            copyText.select();
            copyText.setSelectionRange(0, 99999); /*For mobile devices*/

            /* Copy the text inside the text field */
            document.execCommand("copy");
        }

        function isUrl(s) {
            var regexp = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/
            return regexp.test(s);
        }

        function submit() {
            if($('#urlToShorten').val() && isUrl($('#urlToShorten').val())){
                $('#urlToShorten').removeClass("uk-form-danger");
                $('#urlToShorten').addClass("uk-form-success");

                $.ajax({
                    type: 'POST',
                    url: '/api/new',
                    data: JSON.stringify(
                        {
                            url: $('#urlToShorten').val()
                        }
                    ),
                    success: function(data) {
                        UIkit.notification('De url is verkleind :)', {pos: 'bottom-left', status: 'success'})
                        $('#inputForm').addClass("uk-hidden");
                        $('#successNotification').removeClass("uk-hidden");
                        $("#smallText").html('Nice, je URL is nu lekker kort :D');

                        $("#newUrl").val(data.Response.newUrl);
                    },
                    error: function(data) {
                        UIkit.notification(data.responseJSON.Message, {pos: "bottom-left", status: 'danger'});
                    },
                    contentType: "application/json",
                    dataType: 'json'
                });
            } else {
                $('#urlToShorten').addClass("uk-form-danger");
                $('#urlToShorten').removeClass("uk-form-success");
                if ($('#urlToShorten').val()) {
                    UIkit.notification('De waarde moet een url zijn! :)', {pos: 'bottom-left', status: 'danger'})
                } else {
                    UIkit.notification('De url mag niet leeg zijn :(', {pos: 'bottom-left', status: 'danger'})
                }
                $('#inputForm').removeClass("uk-hidden");
                $('#successNotification').addClass("uk-hidden");
                $("#smallText").html('Lekker snel een URL verkleinen?');
            }
        }

        if (window.location.pathname === '/error') {
            $("#errorMessage").removeClass("uk-hidden");
        }
    </script>
</body>
</html>